<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShareMap Radio Configuration</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“¡ ShareMap Radio Configuration</h1>
            <p class="subtitle">Hardware Radio Configuration Interface</p>
        </header>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash {{ category }}">
                            <span class="flash-icon">
                                {% if category == 'success' %}âœ“{% else %}âš {% endif %}
                            </span>
                            {{ message }}
                            <button class="flash-close" onclick="this.parentElement.remove()">Ã—</button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <form method="POST" action="{{ url_for('submit_config') }}" id="configForm">
            <!-- UDP Target Configuration -->
            <div class="card udp-config">
                <h2>ðŸŽ¯ UDP Target</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="udp_host">Host</label>
                        <input type="text" id="udp_host" name="udp_host" value="localhost" 
                               placeholder="e.g., localhost or 192.168.1.100">
                    </div>
                    <div class="form-group">
                        <label for="udp_port">Port</label>
                        <input type="number" id="udp_port" name="udp_port" value="5000" 
                               min="1" max="65535">
                    </div>
                </div>
            </div>

            <!-- Configuration Groups -->
            {% for group_name, fields in groups.items() %}
            {% if fields %}
            <div class="card config-group" id="group-{{ group_name|lower|replace(' ', '-') }}">
                <h2>
                    <span class="collapse-toggle" onclick="toggleGroup(this)">â–¼</span>
                    {% if 'TX' in group_name %}ðŸ“¤{% elif 'RX' in group_name %}ðŸ“¥{% else %}ðŸ”—{% endif %}
                    {{ group_name }}
                </h2>
                <div class="group-content">
                    {% for field_name, details in fields %}
                    <div class="form-group" data-field="{{ field_name }}">
                        <label for="{{ field_name }}">
                            {{ field_name.replace('_', ' ').title() }}
                            {% if details.get('unit') %}
                                <span class="unit">({{ details.unit }})</span>
                            {% endif %}
                        </label>
                        
                        {% if details.type == 'boolean' %}
                            <!-- Boolean Toggle -->
                            <label class="toggle">
                                <input type="checkbox" 
                                       id="{{ field_name }}" 
                                       name="{{ field_name }}"
                                       {% if defaults.get(field_name) %}checked{% endif %}
                                       {% if details.get('mutex_with') %}
                                       data-mutex="{{ details.mutex_with }}"
                                       onchange="handleMutex(this)"
                                       {% endif %}>
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">{{ 'Enabled' if defaults.get(field_name) else 'Disabled' }}</span>
                            </label>
                        
                        {% elif details.get('options') %}
                            <!-- Dropdown for options -->
                            <select id="{{ field_name }}" name="{{ field_name }}">
                                {% for option in details.options %}
                                    <option value="{{ option }}" 
                                            {% if defaults.get(field_name) == option %}selected{% endif %}>
                                        {{ option if option else '(none)' }}
                                    </option>
                                {% endfor %}
                            </select>
                        
                        {% elif details.type in ['f32', 'f64', 'u8', 'u16', 'u32', 'u64', 'i8', 'i16', 'i32', 'i64'] %}
                            <!-- Numeric input -->
                            <input type="text" 
                                   id="{{ field_name }}" 
                                   name="{{ field_name }}"
                                   value="{{ defaults.get(field_name, 0) }}"
                                   {% if details.get('min') is not none %}data-min="{{ details.min }}"{% endif %}
                                   {% if details.get('max') is not none %}data-max="{{ details.max }}"{% endif %}
                                   {% if details.get('step') %}step="{{ details.step }}"{% endif %}
                                   class="numeric-input"
                                   onchange="validateNumeric(this)">
                            {% if details.get('min') is not none or details.get('max') is not none %}
                                <span class="range-hint">
                                    {% if details.get('min') is not none %}Min: {{ details.min }}{% endif %}
                                    {% if details.get('min') is not none and details.get('max') is not none %} | {% endif %}
                                    {% if details.get('max') is not none %}Max: {{ details.max }}{% endif %}
                                </span>
                            {% endif %}
                        
                        {% else %}
                            <!-- Text input -->
                            <input type="text" 
                                   id="{{ field_name }}" 
                                   name="{{ field_name }}"
                                   value="{{ defaults.get(field_name, '') }}"
                                   maxlength="63">
                        {% endif %}
                        
                        <p class="description">{{ details.desc }}</p>
                        <span class="error-message" id="error-{{ field_name }}"></span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% endfor %}

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    ðŸ“¡ Send Configuration
                </button>
                <button type="button" class="btn btn-secondary" onclick="resetToDefaults()">
                    ðŸ”„ Reset to Defaults
                </button>
                <a href="{{ url_for('export_config') }}" class="btn btn-secondary">
                    ðŸ’¾ Export YAML
                </a>
                <button type="button" class="btn btn-secondary" onclick="validateAll()">
                    âœ“ Validate
                </button>
            </div>
        </form>

        <!-- Validation Summary -->
        <div id="validation-summary" class="card" style="display: none;">
            <h2>Validation Results</h2>
            <div id="validation-content"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
